# bai-sn-odm-helper

These are the steps I used in the video to install and run bai single node on a MacOS desktop. BAI Single Node is a lot like the full install, but does not give you the ability to collect information in Hadoop.

As always, please refer to the official IBM documentation for this [https://www.ibm.com/support/knowledgecenter/SSYHZ8_19.0.x/com.ibm.dba.bai/topics/con_bai_sn_overview.html]

Before ~~messing with~~ using the contents of this repo, you should complete your BAI install to the point of having run the --init  

I assume you already have ODM installed on your desktop. I used the miniload ruleset to demonstrate BAI. You get the miniload ruleset by installing ODM samples server.

1. Clone this git
2. Acquire BAI, for which you'll need an IBM license
3. Acquire / Install / Start Docker Desktop
4. Unzip BAI
5. Configure BAI by editing its .env file
6. Run BAI initially, in order to create truststores and other artifacts. Check that Flink and Kafka are running. Point Kafka to the odm-timeseries.
7. Rebuild and deploy the ODM decisionService.war file with parameter values generated by the BAI initialization, see below
8. Restart ODM. Go to Decision Center. Set Ruleset Properties to include four bai properties. Deploy the project.
9. In ODM / Decision Server go to the HTDS tester, and run one test of your ruleset.
10. Open Kafka - you should see one transaction
11. In Kafka
* Modify the timeseries so that the boolean value 'accept loan' produces a text string 'AcceptAsLabel' either Reject or Accepted.
* Add a visualization. I used a wordcloud, but I prebuilt several other visualizations.
* Add the visualization to a dashboard
* Run some load through ODM and watch the dashboard change over time


## Using this repo

### Part One - Rebuilding the ODM decisionService.war

There are two parts to this git repo. The first is the plugin-configuration.properties, which is an example, and a script to modify the ODM decisionService.war file. This properties file must be edited by you, or by the script as explained below. The last two lines must have the path to your bai/kafka truststore, and its password. The truststore and its password are generated the first time you run bai-start using the --init param. So do that first.

```
com.ibm.rules.bai.plugin.kafka.ssl.truststore.location=/Users/dtt/bai-single-node-19.0.3/certs/kafka/truststore.jks
com.ibm.rules.bai.plugin.kafka.ssl.truststore.password=d74950e5-e03f-4b4d-90dd-7c0c4e3b3709
```

The script b_modify_odm_to_emit_events.sh *must* be modified by you to include your paths to bai, wlp, odm, java, etc. Once that is done, and assuming you have ODM installed on your machine, it *should* install a modified war file. The modified war file will tell ODM to emit events to the kafka that you install as part of BAI. It will make those edits to the plugin-configuration.properties that I talked about earlier. Just double check to make sure they're right.


### Part two - Running loads through ODM miniloan

In the NodeJS folder, there are two node apps. 
1. hello_loans.js
2. slow_loans.js

They are both similar in that they both run load through ODM, which in turn will send events to BAI. The first one, hello_loans.js, runs load faster than ODM can keep up, and therefore does little to show animated bai dashboards. The second one, slow_loans.js takes to parameters. The first is the number of loans you want to send, which can be anywhere from 1 to 200 and defaults to 200 (although I don't check your input values). The second is the number of milliseconds between each transation, and defaults to 600. At the end of the video I ran 100 loan transactions through the system at about 2 per second.









